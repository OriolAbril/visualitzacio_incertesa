<!doctype html>
<html lang="ca">
  <head>
    <meta charset="utf-8">
    <title>Com visualitzar incertesa i models probabilistics | PyDataBCN</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link href="https://use.fontawesome.com/releases/v6.4.0/css/all.css" rel="stylesheet">
    <link rel="stylesheet" href="reveal.js/dist/reveal.css">
    <link rel="stylesheet" href="reveal.js/dist/theme/solarized.css">
    <link rel="stylesheet" href="css/reveal-override.css">
  </head>
  <body>

    <div class="reveal logo">
      <div class="slides">

        <section>
          <h2>Com visualitzar incertesa i models probabilistics</h2>
          <p>a: <b>PyDataBCN 2023</b></p>
          <p>ponent: <b>Oriol Abril Pla</b></p>
          <div>
            <a href="https://oriolabrilpla.cat/ca"><i class="fa-solid fa-globe"></i></a>
            <a href="https://github.com/OriolAbril"><i class="fa-brands fa-github"></i></a>
            <a href="https://twitter.com/OriolAbril"><i class="fa-brands fa-twitter"></i></a>
            <a href="https://toot.cat/@oriolabril"><i class="fa-brands fa-mastodon"></i></a>
          </div>

            <aside class="notes">
            </aside>
        </section>

        <section>
          <h1>Qui soc</h1>
          <ul class="no-marker">
            <li>Membre de <a href="https://www.pymc.io">PyMC</a> i <a href="https://www.arviz.org">ArviZ</a></li>
            <li>Mantenidor de programari lliure</li>
            <li>Consultor sobre modelització bayesiana</li>
            <li>Instructor a <a href="https://www.intuitivebayes.com/">IntuitiveBayes</a></li>
          </ul>

          <aside class="notes">
          </aside>
        </section>

        <section>
        <section>
          <h2>Conceptes estadístics útils per al taller</h2>

          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Conceptes estadístics útils per al taller</h2>
          <h3>Variable aleatòria</h3>

          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h3>Variable aleatòria</h3>

          <p><b>Estadística frequentista:</b> probabilitat com a freqüència en repetir el procés infinites vegades</p>
          <p><b>Estadística bayesiana:</b> probabilitat com a seguretat en cadascun dels possibles resultats</p>

          <aside class="notes">
            Una variable aleatòria és un objecte matemàtic que assigna un
            valor numèric a cadascuna de les possibilitats d'un experiment
            o procés aleatori.

            En estadística frequentista, la probabilitat de cadascun d'aquests
            valors possibles s'enten com la freqüència relativa de cada valor
            que obtindriem en repetir l'experiment infinites vegades.

            En estadística bayesiana, la probabilitat s'enten com la seguretat
            o confiança en cadascun dels resultats d'un experiment o procés aleatori.
          </aside>
        </section>

        <section data-auto-animate>
          <h3>Variable aleatòria</h3>

          <p><s><b>Estadística frequentista:</b> probabilitat com a freqüència en repetir el procés infinites vegades</s></p>
          <p><s><b>Estadística bayesiana:</b> probabilitat com a seguretat en cadascun dels possibles resultats</s></p>

          <aside class="notes">
            Tot el que veurem avui és independent del paradigma estadístic que
            s'utilitzi per obtenir les distribucions que graficarem.
          </aside>
        </section>

        <section data-auto-animate>
          <h3>Variable aleatòria</h3>
          <h4>Matemàticament</h4>
          <ul class="no-marker">
            <li>Funció de distribució (CDF)</li>
            <li>Funció de densitat/massa de probabilitat (PDF/PMF)</li>
          </ul>
          </p>

          <aside class="notes">
            Per tal de poder treballar formalment amb variables aleatòries,
            es defineixen com a objectes matemàtics com hem dit, utilitzant
            la funció de distribució (CDF per les seves sigles en anglès,
            cumulative density function) o la funció de densitat de probabilitat
            (PDF en anglès) per variables contínues, o l'equivalent per
            variables discretes funció de massa de probabilitat (PMF en anglès).
          </aside>
        </section>

        <section data-auto-animate>
          <h3>Variable aleatòria</h3>

          <img src="imatges/variable_aleatoria_mates.png" alt="Gràfics de les funcions de distribució i funcions de densitat/massa de probabilitat per a tres variables aleatòries: una gaussiana, una beta i una poisson"/>
          <aside class="notes">
          </aside>
        </section>
        </section>


        <section>
        <section data-auto-animate>
          <h2>Variables aleatòries en context</h2>

          <aside class="notes">
            La xerrada no és sobre modelització probabilistica ni inferència,
            per tant no entrarem gens en detall, és un apunt principalment a
            nivell de motivació.

            Els models probabilistics són aquells que tracten alguns dels
            seus paràmetres o observacions com a variables aleatòries enlloc
            de quantitats fixes/deterministiques. El seu objectiu per tant
            no és trobar un valor pels paràmetres o fer prediccions numèriques,
            sinó obtenir les seves funcions de distribució.

            A la pràctica però, gairebé mai es possible obtenir les funcions
            de distribució com a funcions, sinó que només podem obtenir mostres
            generades per la distribució objectiu sense conèixer-la directament
            a través de diferents mètodes com ara Monte Carlo.
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Variables aleatòries en context</h2>

          <img src="imatges/variable_aleatoria_practica.png" alt="Extensió de la imatge mostrada fa dues diapositives. Encara amb les mateixes tres variables aleatòries (gaussiana, beta i poisson) afegim una fila més al gràfic. Als gràfics de les funcions de distribució i funcions de densitat/massa de probabilitat hi sumem el resultat de cinc processos de mostreig independents"/>
          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <img src="imatges/variable_aleatoria_practica.png" alt="Extensió de la imatge mostrada fa dues diapositives. Encara amb les mateixes tres variables aleatòries (gaussiana, beta i poisson) afegim una fila més al gràfic. Als gràfics de les funcions de distribució i funcions de densitat/massa de probabilitat hi sumem el resultat de cinc processos de mostreig independents"/>
          <aside class="notes">
          </aside>
        </section>
        </section>

        <section>
        <section data-auto-animate>
          <h2>Visualització de dades</h2>
          <h3>Cal?</h3>

          <aside class="notes">
            Sigui perquè tenim resultats experimentals o perquè tenim
            resultats de models probabilístics, és molt habitual trobar-nos
            amb mostres d'una distribució desconeguda i haver de visualitzar-les
            per intentar tenir una idea de la distribució que les hagi pogut generar,
            poder veure quins valors són més probables, llegir probabilitats
            d'obtenir valors en un cert interval...

            Visualitzar les dades és molt útil ja que ens permet codificar
            molta informació en poc espai i llegir-la de manera molt eficient.
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Visualització de dades</h2>

          <img src="imatges/boxplot_issues.png" alt="Gràfic que mostra com quatre mostres clarament diferents tal com es veu als seus histogrames tenen els mateixos quartils i extrems, generant el mateix box plot en tots quatre casos."/>

          <aside class="notes">
            Per una banda, qualsevol resum numèric perd molta informació.
            Per tal de fer-nos una idea de la incertesa i la distribució
            de probabilitat com a global hem d'utilitzar molts estadístics
            diferents, tants que llegir-los d'una taula no és útil, i/o
            codificar la informació d'una altra manera, com ara aproximant
            la cdf o la pdf.
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Visualització de dades</h2>

          <img src="imatges/espai_diseny.png" alt="Diagrama il·lustratiu de l'espai de diseny de visualitzacions, que conté un nombre immens de possibilitats. La majoria no són adients per a la nostra tasca, algunes són acceptables, i només un grapat són bones sol·lucions. A l'esquerra mostra un bon procés de diseny: el ventall de visualizacions conegudes és molt gran, les considerades no són tantes però també són nombroses i per tant, contenen una visualització que és bona solució. A la dreta hi mostra un mal procés de diseny: el nombre de visualitzacions conegudes es petit, per tant les visualitzacions considerades només poden ser menys que les conegudes; en aquest cas, només hi ha una solució acceptable dins de l'espai conegut, i cap dins del considerat."/>
          <aside class="notes">
            Ara bé, la visualització de dades és una tasca complicada perquè
            no hi ha solucions generals sinó que la visualització adient
            per a cada situació i públic pot ser diferent.
            Avui veurem 4 gràfics diferents per visualitzar variables aleatòries
            a partir de mostres generades amb dos objectius principalment:

            * Ampliar el ventall de gràfics que coneixeu
            * Aprofundir en el coneixement sobre aquests 4 gràfics per tal
              que us sentiu còmodes utilitzant-los.
          </aside>
        </section>
        </section>

        <section>
          <h2>Fil a l'agulla</h2>
          <h4>Quatre maneres de visualitzar mostres com a variables aleatòries</h4>
          <ul>
            <li>Histograma</li>
            <li>Estimadors Nuclears de Densitat (KDE)</li>
            <li>Funcions de distribució empíriques (ECDF)</li>
            <li>Gràfics de punts per quantils</li>
          </ul>

          <aside class="notes">
          </aside>
        </section>

        <!-- ##################  HISTOGRAMA ################# -->
        <section>
        <section data-auto-animate>
          <h2>Histograma</h2>

          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Histograma</h2>

          <h3>Decisions</h3>
          <p>El nombre de classes o l'amplada dels intervals de classe</p>

          <h3>Computació</h3>
          <ol>
            <li>Escollir les classes</li>
            <li>Contar quantes mostres cauen dins de cada classe</li>
          </ol>
          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <video src="videos/histogram.ca.mp4" controls>
            <p>
              El teu navegador no admet videos HTML. Aquí tens un enllaç
              per poder-lo descarregar: <a href="videos/histogram.ca.mp4">link to the video</a>
            </p>
          </video>


          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Histograma</h2>
          <h3>Com generar-lo amb ArviZ</h3>
          <p><a href="https://python.arviz.org/en/stable/api/generated/arviz.plot_dist.html"><code>plot_dist</code></a> amb <code>kind="hist"</code>.</p><p>Arguments d'interès:</p>

          <p><code>hist_kwargs</code>: diccionari amb opcions per configurar l'histograma generat amb la funció <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.hist.html"><code>hist</code> de matplotlib</a>.</p>

          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_dist(mostres, kind="hist");
          </code></pre>

          <img src="imatges/hist_base.png" alt="" height="550px" />
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_dist(mostres, kind="hist", hist_kwargs={"bins": 6});
          </code></pre>

          <img src="imatges/hist_low_bins.png" alt="" height="550px" />
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
ax = az.plot_dist(mostres, kind="hist", hist_kwargs={"bins": 30})
ax.set_xticks(np.linspace(-2, 2, 5));
          </code></pre>

          <img src="imatges/hist_high_bins.png" alt="" height="550px" />
        </section>
        </section>

        <!-- ##################  KDE ################# -->
        <section>
        <section data-auto-animate>
          <h2>Estimador nuclear de densitat (KDE)</h2>

          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Estimador nuclear de densitat (KDE)</h2>

          <h3>Decisions</h3>
          <p><i>El nucli*</i></p>
          <p>L'amplada de banda (o altres paràmetres del nucli)</p>

          <h3>Computació</h3>
          <ol>
            <li>Escollir l'amplada de banda</li>
            <li>Calcular la contribució del nucli corresponent a cada punt i sumar-les</li>
            <li>Calcular la correció de frontera (opcional)</li>
          </ol>
          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <video src="videos/kde.ca.mp4" controls>
            <p>
              El teu navegador no admet videos HTML. Aquí tens un enllaç
              per poder-lo descarregar: <a href="videos/kde.ca.mp4">enllaç al video</a>
            </p>
          </video>


          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Estimador nuclear de densitat (KDE)</h2>
          <h3>Com generar-lo amb ArviZ</h3>
          <p><a href="https://python.arviz.org/en/stable/api/generated/arviz.plot_kde.html"><code>plot_kde</code></a></code>.</p><p>Arguments d'interès:</p>

          <p><code>bw</code>: valor real per a l'amplada de banda o cadena de text amb alguna de les opcions per indicar algoritmes predefinits per calcular l'amplada de banda.</p>
          <p><code>adaptive</code>: booleà indicant si mantenir l'amplada de banda constant o adaptarla segons la regió de la distribució</p>

          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_kde(mostres);
          </code></pre>

          <img src="imatges/kde_base.png" alt="" height="550px" />
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_kde(mostres, bw=0.05);
          </code></pre>

          <img src="imatges/kde_small_bw.png" alt="" height="550px" />
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_kde(mostres, bw=1.5);
          </code></pre>

          <img src="imatges/kde_big_bw.png" alt="" height="550px" />
        </section>
        </section>

        <!-- ##################  dotplot ################# -->
        <section>
        <section data-auto-animate>
          <h2>Gràfic de punts per quantils</h2>

          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Gràfic de punts per quantils</h2>

          <h3>Decisions</h3>
          <p>Nombre de punts</p>
          <p><i>Amplada de classe</i></p>


          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Gràfic de punts per quantils</h2>

          <h3>Computació</h3>
          <ol>
            <li>Escollir l'amplada de classe i el nombre de punts</li>
            <li>Calcular tants quantils com punts es vulguin. Els quantils es calculen equiespaiats entre 0 i 1 (cap dels dos inclosos)</li>
            <li>Començant per l'esquerra:</li>
            <ul>
              <li>Mirar quants quantils queden dins de l'interval <code>quantil_actual + amplada_de_classe</code></li>
              <li>Escollir la x per als punts com a <code>(quantil_actual + ultim_quantil_interval) / 2</code>.</li>
              <li>Apilar tants punts com quantils haguem trobat dins l'interval</li>
              <li>Repetir el procés considerant el quantil actual com al primer quantil <em>fora</em> de l'interval</li>
            </ul>
          </ol>
          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Gràfic de punts per quantils</h2>

          <h3>Computació</h3>
          <ol start="3">
            <li>Començant per l'esquerra:</li>
            <ul>
              <li>Mirar quants quantils queden dins de l'interval <code>quantil_actual + amplada_de_classe</code></li>
              <li>Escollir la x per als punts com a <code>(quantil_actual + ultim_quantil_interval) / 2</code>.</li>
              <li>Apilar tants punts com quantils haguem trobat dins l'interval</li>
              <li>Repetir el procés considerant el quantil actual com al primer quantil <em>fora</em> de l'interval</li>
            </ul>
          </ol>
          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <video src="videos/dotplot.ca.mp4" controls>
            <p>
              El teu navegador no admet videos HTML. Aquí tens un enllaç
              per poder-lo descarregar: <a href="videos/dotplot.ca.mp4">enllaç al video</a>
            </p>
          </video>


          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Gràfic de punts per quantils</h2>
          <h3>Com generar-lo amb ArviZ</h3>
          <p><a href="https://python.arviz.org/en/stable/api/generated/arviz.plot_dot.html"><code>plot_dot</code></a></code>.</p><p>Arguments d'interès:</p>

          <p><code>nquantiles</code>: nombre de punts pel gràfic generat</p>
          <p><code>binwidth</code>: amplada de classe</p>
          <p><code>dotsize</code>: ratio entre la mida dels punts i el binwidth</p>
          <p><code>stackratio</code>: distància vertical entre punts apilats</p>

          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_dot(mostres);
          </code></pre>

          <img src="imatges/dot_base.png" alt="" height="550px" />
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_dot(mostres, stackratio=1.3);
          </code></pre>

          <img src="imatges/dot_stackratio.png" alt="" height="550px" />
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_dot(mostres, dotsize=1.2);
          </code></pre>

          <img src="imatges/dot_dotsize.png" alt="" height="550px" />
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_dot(mostres, binwidth=0.1);
          </code></pre>

          <img src="imatges/dot_binwidth.png" alt="" height="550px" />
        </section>
        </section>

        <!-- ##################  ECDF ################# -->
        <section>
        <section data-auto-animate>
          <h2>Funció de distribució empírica (ECDF)</h2>

          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Funció de distribució empírica (ECDF)</h2>

          <h3>Decisions</h3>
          <p><i>Cap*</i></p>

          <h3>Computació</h3>
          <ol>
            <li>Ordenar les mostres</li>
            <li>Començant per l'esquerra, anar gràficant els esglaons, incrementant la y en <code>1/numero_de_mostres</code> a cada mostra.</li>
          </ol>
          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <video src="videos/ecdf.ca.mp4" controls>
            <p>
              El teu navegador no admet videos HTML. Aquí tens un enllaç
              per poder-lo descarregar: <a href="videos/ecdf.ca.mp4">enllaç al video</a>
            </p>
          </video>


          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <h2>Funció de distribució empírica (ECDF)</h2>
          <h3>Com generar-lo amb ArviZ</h3>
          <p><a href="https://python.arviz.org/en/stable/api/generated/arviz.plot_ecdf.html"><code>plot_ecdf</code></a></code>.</p><p>Arguments d'interès:</p>

          <p><code>npoints</code>: valor enter que indíca el nombre de punts a la quadrícula on evaluar la funció de distribució empírica.</p>

          <aside class="notes">
          </aside>
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_ecdf(mostres);
          </code></pre>

          <img src="imatges/ecdf_base.png" alt="" height="550px" />
        </section>

        <section data-auto-animate>
          <pre class="python" data-id="code"><code data-noescape>
az.plot_ecdf(mostres, npoints=40);
          </code></pre>

          <img src="imatges/ecdf_npoints.png" alt="" height="550px" />
        </section>
        </section>

        <section>
          <img src="imatges/diagrama_resum.png" alt="" />
        </section>

        <section>
        <section>
          <h2>Exemples: mans a l'obra!</h2>

          <p>Descarregueu <a href="dades_pydata.csv">aquest fitxer .csv</a>. Conté les dades per als exercics que venen a continuació.</p>
          <p>També heu d'instal·lar <a href="https://python.arviz.org/en/stable/getting_started/Installation.html">ArviZ</a>.
        </section>

        <section>
          <h2>Esperant l'autobús</h2>

          <p style="font-size: 30px">Estàs esperant l'autobús per tornar a casa després de fer encàrrecs. La parada està a uns 15 minuts de casa caminant. Acaben d'actualitzar les pantalles a les parades i ara enlloc de donar un valor et permeten fer un gràfic d'incertesa amb mostres dels temps d'arribada esperats segons el seu model probabilistic.</p>
        </section>

        <section>
          <h2>Seure a l'autobús</h2>

          <p style="font-size: 30px">Mateixa situació que l'anterior, però amb més dades disponibles. A més del temps que trigarà en arribar, també pots generar gràfics de la gent que hi haurà a l'autobús quan arribi. A la parada de moment hi ha 3 persones més esperant, i l'autobús té 37 seients i un aforament màxim de 136 places.</p>
        </section>

        <section>
          <h2>V5 o V7?</h2>

          <p style="font-size: 30px">Encara una altra situació similar. Us trobeu en un punt intermedi entre dues parades de bus, una del V5 i una altra del V7. Voleu anar a un altre punt que també és intermedi entre tots dos. Quin d'ells agafarieu?.</p>
        </section>
        </section>

        <section>
          <h2>Com visualitzar incertesa i models probabilistics</h2>
          <p>a: <b>PyDataBCN 2023</b></p>
          <p>ponent: <b>Oriol Abril Pla</b></p>
          <div>
            <a href="https://oriolabrilpla.cat/ca"><i class="fa-solid fa-globe"></i></a>
            <a href="https://github.com/OriolAbril"><i class="fa-brands fa-github"></i></a>
            <a href="https://twitter.com/OriolAbril"><i class="fa-brands fa-twitter"></i></a>
            <a href="https://toot.cat/@oriolabril"><i class="fa-brands fa-mastodon"></i></a>
          </div>

            <aside class="notes">
            </aside>
        </section>

      </div>
    </div>

    <script src="reveal.js/dist/reveal.js"></script>
    <link rel="stylesheet" href="reveal.js/plugin/highlight/zenburn.css">
    <script src="reveal.js/plugin/highlight/highlight.js"></script>
    <script src="reveal.js/plugin/math/math.js"></script>
    <script src="reveal.js/plugin/notes/notes.js"></script>
    <script>
      Reveal.initialize({
        plugins: [ RevealHighlight, RevealMath, RevealNotes ],
        hash: false,
        transition: 'none'
      });
    </script>

  </body>
</html>
